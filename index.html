<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NE Drawing</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        #feedbackMessage {
            margin: 10px 0;
            color: green;
        }
    </style>
</head>

<body>
    <input type="file" id="imageInput">
    <div id="feedbackMessage"></div>
    <label>Clip Size: <input type="range" id="clipSizeSlider" min="5" max="100" value="20"></label>
    <button id="clearCanvas">Clear Canvas</button>
    <canvas id="drawingCanvas" width="400" height="400" style="border: 1px solid;"></canvas>

    <script>
        const canvas = document.getElementById("drawingCanvas");
        const ctx = canvas.getContext("2d");
        const clipSizeSlider = document.getElementById("clipSizeSlider");
        let imgData = [];
        let isDrawing = false;

        document.getElementById("imageInput").addEventListener("change", function (event) {
            let file = event.target.files[0];
            if (file) {
                if (!file.type.startsWith('image/')) {
                    alert("Please select a valid image file.");
                    return;
                }

                let reader = new FileReader();
                reader.onload = function (e) {
                    let img = new Image();
                    img.onload = function () {
                        let scale = Math.min(canvas.width / img.width, canvas.height / img.height);
                        let x = (canvas.width - img.width * scale) / 2;
                        let y = (canvas.height - img.height * scale) / 2;
                        ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
                        imgData.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
                        document.getElementById("feedbackMessage").textContent = "Image loaded. Now draw on the canvas.";
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        function draw(event, x, y) {
            let clipSize = parseInt(clipSizeSlider.value, 10);
            let canvasX = x - canvas.offsetLeft;
            let canvasY = y - canvas.offsetTop;

            // Check boundary conditions
            if (canvasX < 0 || canvasY < 0 || canvasX > canvas.width || canvasY > canvas.height) return;

            if (imgData.length > 0) {
                let randomImgData = imgData[Math.floor(Math.random() * imgData.length)];
                let tempCanvas = document.createElement('canvas');
                let tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = canvas.width;
                tempCanvas.height = canvas.height;
                tempCtx.putImageData(randomImgData, 0, 0);

                let randomX = Math.floor(Math.random() * (canvas.width - clipSize));
                let randomY = Math.floor(Math.random() * (canvas.height - clipSize));

                let clippedImage = tempCtx.getImageData(randomX, randomY, clipSize, clipSize);

                ctx.putImageData(clippedImage, canvasX - clipSize / 2, canvasY - clipSize / 2);
            }
        }

        // Mouse events
        canvas.addEventListener("mousedown", () => isDrawing = true);
        canvas.addEventListener("mouseup", () => isDrawing = false);
        canvas.addEventListener("mousemove", (event) => draw(event, event.clientX, event.clientY));

        // Touch events for mobile
        canvas.addEventListener("touchstart", function (e) {
            e.preventDefault();
            isDrawing = true;
        });
        canvas.addEventListener("touchend", () => isDrawing = false);
        canvas.addEventListener("touchmove", function (e) {
            e.preventDefault();
            let touch = e.touches[0];
            draw(e, touch.clientX, touch.clientY);
        });

        document.getElementById("clearCanvas").addEventListener("click", function () {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });
    </script>
</body>

</html>
